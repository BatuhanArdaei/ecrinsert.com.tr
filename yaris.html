<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Capy Hill Racing ULTIMATE üèÜ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Russo+One&display=swap');

        body {
            margin: 0; overflow: hidden; background-color: #87CEEB;
            font-family: 'Russo One', sans-serif; touch-action: none; user-select: none;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* UI KATMANI */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: space-between; padding: 20px; box-sizing: border-box;
        }

        .top-bar {
            display: flex; justify-content: space-between; align-items: flex-start; width: 100%;
        }

        /* Benzin G√∂stergesi */
        .fuel-container {
            background: rgba(0, 0, 0, 0.7); padding: 10px 20px; border-radius: 15px;
            border: 3px solid #fff; width: 250px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .fuel-text { color: white; font-size: 14px; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .fuel-bar-bg { width: 100%; height: 15px; background: #333; border-radius: 10px; overflow: hidden; }
        .fuel-bar-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #e74c3c, #f1c40f); transition: width 0.2s; }

        /* Skor ve Altƒ±n */
        .stats-box {
            display: flex; flex-direction: column; gap: 10px; align-items: flex-end;
        }
        .score-tag, .coin-tag {
            background: rgba(0,0,0,0.7); color: #fff; padding: 8px 20px;
            border-radius: 10px; border: 2px solid #fff; font-size: 20px;
            text-shadow: 1px 1px 0 #000; min-width: 100px; text-align: right;
        }
        .coin-tag { color: #ffd700; border-color: #ffd700; }

        /* Kontroller */
        .controls {
            display: flex; justify-content: space-between; width: 100%; padding-bottom: 20px; pointer-events: auto;
        }

        .pedal {
            width: 110px; height: 140px; border-radius: 20px;
            border: 4px solid rgba(255,255,255,0.5);
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            font-size: 20px; color: white; padding-bottom: 20px;
            cursor: pointer; transition: transform 0.1s;
            box-shadow: 0 10px 0 rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
        }
        .pedal:active, .pedal.active { transform: translateY(10px); box-shadow: none; filter: brightness(1.2); }

        #brake { background: linear-gradient(180deg, #ff6b6b, #c0392b); }
        #gas { background: linear-gradient(180deg, #2ecc71, #27ae60); }

        /* Game Over */
        #game-over {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; flex-direction: column;
            align-items: center; justify-content: center; color: white; z-index: 50; pointer-events: auto;
        }
        #game-over h1 { font-size: 3.5rem; color: #e74c3c; margin: 0; text-shadow: 0 0 20px rgba(231, 76, 60, 0.5); }
        .restart-btn {
            margin-top: 30px; padding: 15px 60px; font-size: 1.5rem; font-family: 'Russo One', sans-serif;
            background: #f1c40f; color: #333; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
            transition: transform 0.1s;
        }
        .restart-btn:active { transform: scale(0.95); }

        /* Bildirimler (Benzin alƒ±ndƒ± vs) */
        .toast {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 2rem; color: #2ecc71; text-shadow: 2px 2px 0 #000;
            opacity: 0; transition: opacity 0.5s, transform 0.5s; pointer-events: none;
        }
        .toast.show { opacity: 1; transform: translate(-50%, -150%); }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="top-bar">
            <div class="fuel-container">
                <div class="fuel-text"><span>BENZƒ∞N</span> <span id="fuel-val">100%</span></div>
                <div class="fuel-bar-bg"><div id="fuel-fill" class="fuel-bar-fill"></div></div>
            </div>
            <div class="stats-box">
                <div class="score-tag">üèÅ <span id="score">0</span> m</div>
                <div class="coin-tag">üí∞ <span id="coins">0</span></div>
            </div>
        </div>
        <div class="controls">
            <div id="brake" class="pedal">FREN</div>
            <div id="gas" class="pedal">GAZ</div>
        </div>
        <div id="toast" class="toast">+ BENZƒ∞N!</div>
    </div>

    <div id="game-over">
        <h1 id="go-title">BOYNU KIRILDI!</h1>
        <p style="font-size: 1.5rem; color: #aaa;">Toplam Skor: <span id="final-score">0</span></p>
        <button class="restart-btn" onclick="location.reload()">TEKRAR DENE</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

    <script>
        // === PERLIN NOISE (Rastgele Tepeler) ===
        const Noise={p:new Uint8Array(512),permutation:[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],init:function(){for(let i=0;i<256;i++)this.p[256+i]=this.p[i]=this.permutation[i]},fade:function(t){return t*t*t*(t*(t*6-15)+10)},lerp:function(t,a,b){return a+t*(b-a)},grad:function(hash,x,y,z){const h=hash&15;const u=h<8?x:y,v=h<4?y:h==12||h==14?x:z;return((h&1)==0?u:-u)+((h&2)==0?v:-v)},noise:function(x,y,z){const X=Math.floor(x)&255,Y=Math.floor(y)&255,Z=Math.floor(z)&255;x-=Math.floor(x);y-=Math.floor(y);z-=Math.floor(z);const u=this.fade(x),v=this.fade(y),w=this.fade(z);const A=this.p[X]+Y,AA=this.p[A]+Z,AB=this.p[A+1]+Z,B=this.p[X+1]+Y,BA=this.p[B]+Z,BB=this.p[B+1]+Z;return this.lerp(w,this.lerp(v,this.lerp(u,this.grad(this.p[AA],x,y,z),this.grad(this.p[BA],x-1,y,z)),this.lerp(u,this.grad(this.p[AB],x,y-1,z),this.grad(this.p[BB],x-1,y-1,z))),this.lerp(v,this.lerp(u,this.grad(this.p[AA+1],x,y,z-1),this.grad(this.p[BA+1],x-1,y,z-1)),this.lerp(u,this.grad(this.p[AB+1],x,y-1,z-1),this.grad(this.p[BB+1],x-1,y-1,z-1))))}};
        Noise.init();

        const Engine = Matter.Engine, Render = Matter.Render, Runner = Matter.Runner, Composite = Matter.Composite, Body = Matter.Body, Bodies = Matter.Bodies, Constraint = Matter.Constraint, Events = Matter.Events;

        const engine = Engine.create();
        const world = engine.world;
        const render = Render.create({
            element: document.body, engine: engine,
            options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: '#87CEEB', hasBounds: true, pixelRatio: window.devicePixelRatio }
        });

        // === DEƒûƒ∞≈ûKENLER ===
        let car, wheel1, wheel2;
        let fuel = 100;
        let score = 0;
        let coins = 0;
        let isGameOver = false;
        
        // Zemin ve E≈üyalar
        let terrainBodies = [];
        let collectables = []; // Benzin bidonlarƒ± ve altƒ±nlar
        let lastX = -500;
        const segmentW = 60;
        
        let particles = [];

        // === YARDIMCI: ZEMƒ∞N Y√úKSEKLƒ∞ƒûƒ∞ ===
        function getTerrainHeight(x) {
            // x=0 civarƒ±nda d√ºz olsun ki araba rahat doƒüsun
            if (Math.abs(x) < 300) return window.innerHeight - 250;

            // Uzakla≈ütƒ±k√ßa tepeler ba≈ülasƒ±n
            let noise = Noise.noise(x * 0.0025, 0, 0) * 250;
            let difficulty = Math.min(2, Math.max(1, Math.abs(x) / 3000)); // Zorluk artƒ±≈üƒ±
            
            return (window.innerHeight - 250) - (noise * difficulty);
        }

        // === ZEMƒ∞N √úRETƒ∞Mƒ∞ VE E≈ûYALAR ===
        function generateTerrain() {
            // Araba ilerledik√ße yeni zemin olu≈ütur
            const drawLimit = (car ? car.position.x : 0) + window.innerWidth + 1000;

            while (lastX < drawLimit) {
                const x1 = lastX;
                const y1 = getTerrainHeight(x1);
                const x2 = lastX + segmentW;
                const y2 = getTerrainHeight(x2);

                const angle = Math.atan2(y2 - y1, x2 - x1);
                const midX = (x1 + x2) / 2;
                const midY = (y1 + y2) / 2;
                const dist = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));

                const segment = Bodies.rectangle(midX, midY + 400, dist, 800, {
                    isStatic: true, angle: angle, friction: 1.0, 
                    render: { visible: false }, label: 'Ground'
                });
                segment.drawPoints = [{ x: x1, y: y1 }, { x: x2, y: y2 }];
                
                Composite.add(world, segment);
                terrainBodies.push(segment);

                // E≈ûYA OLU≈ûTURMA (≈ûansa baƒülƒ±)
                // %10 ihtimalle bir ≈üey √ßƒ±kar
                if (x1 > 500 && Math.random() < 0.15) {
                    const type = Math.random() > 0.8 ? 'fuel' : 'coin'; // %20 benzin, %80 altƒ±n
                    collectables.push({
                        x: midX,
                        y: midY - 60, // Zeminin biraz √ºst√º
                        type: type,
                        active: true,
                        wobble: Math.random() * Math.PI
                    });
                }

                lastX += segmentW;
            }

            // Temizlik (Performans)
            if (car && terrainBodies.length > 80) {
                const removeCount = terrainBodies.length - 80;
                if (terrainBodies[removeCount].position.x < car.position.x - window.innerWidth) {
                    const toRemove = terrainBodies.splice(0, removeCount);
                    Composite.remove(world, toRemove);
                    // Toplanmamƒ±≈ü e≈üyalarƒ± da sil
                    collectables = collectables.filter(c => c.x > car.position.x - window.innerWidth);
                }
            }
        }

        // === ARABA (TAM BA≈ûLANGI√á NOKTASINDA) ===
        function createCar() {
            // Arabayƒ± tam 0 noktasƒ±nda, zeminin biraz √ºst√ºnde ba≈ülatƒ±yoruz
            const startX = 0;
            const startY = getTerrainHeight(0) - 150; // Havadan bƒ±rak

            const group = Body.nextGroup(true);

            const chassis = Bodies.rectangle(startX, startY, 160, 35, { 
                collisionFilter: { group: group }, density: 0.004, friction: 0.5, chamfer: { radius: 10 }, render: { visible: false }
            });

            const cabin = Bodies.trapezoid(startX - 15, startY - 35, 90, 50, 0.3, {
                collisionFilter: { group: group }, density: 0.002, render: { visible: false }
            });

            car = Body.create({ parts: [chassis, cabin], collisionFilter: { group: group }, label: 'Car' });

            wheel1 = Bodies.circle(startX - 55, startY + 45, 28, { 
                collisionFilter: { group: group }, friction: 0.9, density: 0.02, restitution: 0.2, render: { visible: false }
            });
            
            wheel2 = Bodies.circle(startX + 55, startY + 45, 28, { 
                collisionFilter: { group: group }, friction: 0.9, density: 0.02, restitution: 0.2, render: { visible: false }
            });

            const axel1 = Constraint.create({
                bodyA: car, pointA: { x: -55, y: 20 }, bodyB: wheel1, pointB: { x: 0, y: 0 },
                stiffness: 0.08, damping: 0.1, length: 0, render: { visible: false }
            });

            const axel2 = Constraint.create({
                bodyA: car, pointA: { x: 55, y: 20 }, bodyB: wheel2, pointB: { x: 0, y: 0 },
                stiffness: 0.08, damping: 0.1, length: 0, render: { visible: false }
            });

            Composite.add(world, [car, wheel1, wheel2, axel1, axel2]);
        }

        // === √áƒ∞Zƒ∞M & OYUN D√ñNG√úS√ú ===
        generateTerrain(); // √ñnce zemin olu≈üsun
        createCar();       // Sonra araba (zemine g√∂re)

        Events.on(render, 'afterRender', function() {
            const ctx = render.context;
            const width = render.canvas.width;
            const height = render.canvas.height;

            // Kamera
            Render.lookAt(render, car, { x: 300, y: 350 });

            // Parallax Arka Plan
            ctx.save();
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            const camX = car.position.x - width * 0.3;
            
            // Bulutlar
            let cloudOffset = camX * 0.1;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.beginPath(); ctx.arc((200 - cloudOffset) % (width+400), 100, 50, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc((600 - cloudOffset) % (width+400), 150, 70, 0, Math.PI*2); ctx.fill();

            // Daƒülar
            let mountOffset = camX * 0.2;
            ctx.fillStyle = '#60a3bc';
            ctx.beginPath(); ctx.moveTo(0, height);
            for(let i=0; i<=width; i+=50) ctx.lineTo(i, height - 150 - Math.sin((i + mountOffset)*0.01)*50);
            ctx.lineTo(width, height); ctx.fill();
            ctx.restore();

            // Zemin √áizimi
            generateTerrain();
            
            ctx.beginPath();
            if (terrainBodies.length > 0) {
                ctx.moveTo(terrainBodies[0].drawPoints[0].x, 3000);
                for (let i = 0; i < terrainBodies.length; i++) {
                    const p1 = terrainBodies[i].drawPoints[0];
                    const p2 = terrainBodies[i].drawPoints[1];
                    // Curve efekti i√ßin quadraticCurveTo kullanƒ±labilir ama lineTo daha performanslƒ±
                    ctx.lineTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                }
                ctx.lineTo(terrainBodies[terrainBodies.length-1].drawPoints[1].x, 3000);
            }
            ctx.closePath();
            const grad = ctx.createLinearGradient(0, 0, 0, height+500);
            grad.addColorStop(0, '#6ab04c'); grad.addColorStop(1, '#3e2723');
            ctx.fillStyle = grad; ctx.fill();
            ctx.lineWidth = 8; ctx.strokeStyle = '#6ab04c'; ctx.stroke();

            // E≈üyalar (Collectibles)
            drawCollectibles(ctx);

            // Araba
            drawCarComponents(ctx);
            drawParticles(ctx);

            // UI ve Mantƒ±k
            if (!isGameOver) {
                score = Math.max(score, Math.floor(car.position.x / 10));
                document.getElementById('score').innerText = score;
                
                if (Math.abs(car.velocity.x) > 0.5) fuel -= 0.05;
                document.getElementById('fuel-fill').style.width = Math.max(0, fuel) + '%';
                document.getElementById('fuel-val').innerText = Math.floor(Math.max(0, fuel)) + '%';

                if (fuel <= 0) triggerGameOver("BENZƒ∞N Bƒ∞TTƒ∞! ‚õΩ");
                if (Math.abs(car.angle) > Math.PI / 1.3) triggerGameOver("BOYNU KIRILDI! ü§ï");
            }
        });

        function drawCollectibles(ctx) {
            for(let i=0; i<collectables.length; i++) {
                let c = collectables[i];
                if(!c.active) continue;

                // Araba ile √ßarpƒ±≈üma kontrol√º (Basit mesafe)
                const dist = Vector.magnitude(Vector.sub(car.position, {x: c.x, y: c.y}));
                if (dist < 80) {
                    c.active = false;
                    if (c.type === 'fuel') {
                        fuel = 100;
                        showToast("BENZƒ∞N FULLENDƒ∞! ‚õΩ");
                    } else {
                        coins += 50;
                        document.getElementById('coins').innerText = coins;
                        showToast("+50 ALTIN! üí∞");
                    }
                    continue;
                }

                // √áizim (Sallanma animasyonu)
                c.wobble += 0.1;
                const yOffset = Math.sin(c.wobble) * 5;

                ctx.save();
                ctx.translate(c.x, c.y + yOffset);
                
                if (c.type === 'fuel') {
                    // Kƒ±rmƒ±zƒ± Bidon
                    ctx.fillStyle = '#e74c3c';
                    ctx.fillRect(-15, -20, 30, 40);
                    ctx.fillStyle = '#c0392b';
                    ctx.fillRect(-15, -20, 30, 10); // Kapak
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 20px Arial';
                    ctx.fillText("F", -6, 10);
                } else {
                    // Altƒ±n
                    ctx.fillStyle = '#f1c40f';
                    ctx.beginPath(); ctx.arc(0, 0, 15, 0, Math.PI*2); ctx.fill();
                    ctx.strokeStyle = '#f39c12'; ctx.lineWidth = 3; ctx.stroke();
                    ctx.fillStyle = '#f39c12';
                    ctx.font = 'bold 20px Arial';
                    ctx.fillText("$", -6, 7);
                }
                ctx.restore();
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 1500);
        }

        function drawCarComponents(ctx) {
            // Tekerlekler
            [wheel1, wheel2].forEach(w => {
                ctx.translate(w.position.x, w.position.y); ctx.rotate(w.angle);
                ctx.fillStyle = '#2d3436'; ctx.beginPath(); ctx.arc(0, 0, 28, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = '#b2bec3'; ctx.beginPath(); ctx.arc(0, 0, 16, 0, Math.PI*2); ctx.fill();
                ctx.strokeStyle = '#636e72'; ctx.lineWidth = 3;
                ctx.beginPath(); ctx.moveTo(-16, 0); ctx.lineTo(16, 0); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, -16); ctx.lineTo(0, 16); ctx.stroke();
                
                // Toz
                if(w.speed > 5 && Math.random()>0.5) spawnParticle(w.position.x, w.position.y+25, 'dust');

                ctx.rotate(-w.angle); ctx.translate(-w.position.x, -w.position.y);
            });

            // S√ºspansiyon
            ctx.strokeStyle = '#333'; ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(car.position.x - 55, car.position.y + 20); ctx.lineTo(wheel1.position.x, wheel1.position.y);
            ctx.moveTo(car.position.x + 55, car.position.y + 20); ctx.lineTo(wheel2.position.x, wheel2.position.y);
            ctx.stroke();

            // Araba G√∂vde
            const pos = car.position; const angle = car.angle;
            ctx.translate(pos.x, pos.y); ctx.rotate(angle);

            ctx.fillStyle = '#e55039'; ctx.beginPath(); ctx.roundRect(-65, -10, 130, 40, 10); ctx.fill();
            ctx.strokeStyle = '#333'; ctx.lineWidth = 3; ctx.stroke();
            ctx.fillStyle = '#eb4d4b'; ctx.beginPath();
            ctx.moveTo(-40, -10); ctx.lineTo(-30, -50); ctx.lineTo(30, -50); ctx.lineTo(45, -10); ctx.fill(); ctx.stroke();

            // Kapibara
            ctx.save(); ctx.translate(-10, -30); 
            ctx.rotate(Math.sin(Date.now() * 0.01) * 0.1 - (car.angularVelocity * 2)); 
            ctx.fillStyle = '#8d6e63'; ctx.beginPath(); ctx.ellipse(0, 10, 15, 18, 0, 0, Math.PI*2); ctx.fill();
            ctx.fillRect(-12, -15, 24, 20);
            ctx.fillStyle = '#3e2723'; ctx.fillRect(10, -5, 6, 8);
            ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(5, -8, 2, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = '#5d4037'; ctx.beginPath(); ctx.arc(-5, -15, 4, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = '#d32f2f'; ctx.fillRect(-12, -18, 24, 5); ctx.fillRect(8, -18, 10, 5);
            ctx.restore();

            if(isGas && Math.random() > 0.7) spawnParticle(pos.x - 70, pos.y + 10, 'smoke');

            ctx.rotate(-angle); ctx.translate(-pos.x, -pos.y);
        }

        function spawnParticle(x, y, type) {
            particles.push({
                x: x, y: y, vx: (Math.random() - 0.5) * 2, vy: (Math.random() - 1) * 2,
                life: 1.0, size: Math.random() * 5 + 5, type: type
            });
        }

        function drawParticles(ctx) {
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i]; p.x += p.vx; p.y += p.vy; p.life -= 0.03; p.size += 0.2;
                if (p.life <= 0) { particles.splice(i, 1); continue; }
                ctx.globalAlpha = p.life * 0.5;
                ctx.fillStyle = p.type === 'smoke' ? '#555' : '#d2b48c';
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
            }
            ctx.globalAlpha = 1;
        }

        function triggerGameOver(reason) {
            if(isGameOver) return;
            isGameOver = true;
            document.getElementById('game-over').style.display = 'flex';
            document.getElementById('go-title').innerText = reason;
            document.getElementById('final-score').innerText = score;
        }

        let isGas = false, isBrake = false;
        
        // PC Kontroller
        document.addEventListener('keydown', e => {
            if(e.code==='ArrowRight' || e.code==='KeyD') isGas=true;
            if(e.code==='ArrowLeft' || e.code==='KeyA') isBrake=true;
        });
        document.addEventListener('keyup', e => {
            if(e.code==='ArrowRight' || e.code==='KeyD') isGas=false;
            if(e.code==='ArrowLeft' || e.code==='KeyA') isBrake=false;
        });

        // Mobil Kontroller
        const setupBtn = (id, type) => {
            const btn = document.getElementById(id);
            const start = (e) => { e.preventDefault(); if(type==='gas') isGas=true; else isBrake=true; btn.classList.add('active'); };
            const end = (e) => { e.preventDefault(); if(type==='gas') isGas=false; else isBrake=false; btn.classList.remove('active'); };
            btn.addEventListener('mousedown', start); btn.addEventListener('mouseup', end);
            btn.addEventListener('touchstart', start); btn.addEventListener('touchend', end);
        };
        setupBtn('gas', 'gas');
        setupBtn('brake', 'brake');

        Events.on(engine, 'beforeUpdate', () => {
            if(isGameOver) return;
            if (isGas && fuel > 0) {
                Body.setAngularVelocity(wheel1, 0.4); Body.setAngularVelocity(wheel2, 0.4);
                Body.setAngularVelocity(car, car.angularVelocity + 0.003);
            }
            if (isBrake) {
                Body.setAngularVelocity(wheel1, -0.3); Body.setAngularVelocity(wheel2, -0.3);
                Body.setAngularVelocity(car, car.angularVelocity - 0.004);
            }
        });

        const runner = Runner.create();
        Runner.run(runner, engine);
        Render.run(render);

        window.addEventListener('resize', () => {
            render.canvas.width = window.innerWidth; render.canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>